[tox]
requires =
    tox>=4.11
    tox-uv>=1.11
    tox-gh>=1.3
env_list =
    edt
    logging
    inputs
    connectors
    lint
    typecheck
    docs
min_version = 4.11
skip_missing_interpreters = true

[gh]
python =
    3.9 = py39
    3.10 = py310
    3.11 = py311
    3.12 = py312
    3.13 = py313
    3.14 = py314

# ── Package test environments ─────────────────────────

[testenv:edt]
description = Test extended-data-types
changedir = packages/extended-data-types
skip_install = true
deps = {toxinidir}/packages/extended-data-types[tests,mcp]
commands = pytest tests --cov --cov-report=xml --cov-report=term-missing {posargs}

[testenv:logging]
description = Test lifecyclelogging
changedir = packages/lifecyclelogging
skip_install = true
deps = {toxinidir}/packages/lifecyclelogging[tests]
commands = pytest tests --cov --cov-report=xml --cov-report=term-missing {posargs}

[testenv:inputs]
description = Test directed-inputs-class
changedir = packages/directed-inputs-class
skip_install = true
deps = {toxinidir}/packages/directed-inputs-class[tests]
commands = pytest tests --cov --cov-report=xml --cov-report=term-missing {posargs}

[testenv:connectors]
description = Test vendor-connectors
changedir = packages/vendor-connectors
skip_install = true
deps = {toxinidir}/packages/vendor-connectors[tests,aws,google,github,slack,vault,anthropic,mcp]
commands = pytest tests --cov --cov-report=xml --cov-report=term-missing {posargs}

# ── Quality environments ──────────────────────────────

[testenv:lint]
description = Lint all Python packages
skip_install = true
deps = ruff>=0.8.0
commands =
    ruff check packages/extended-data-types/src/ packages/extended-data-types/tests/
    ruff check packages/lifecyclelogging/src/ packages/lifecyclelogging/tests/
    ruff check packages/directed-inputs-class/src/ packages/directed-inputs-class/tests/
    ruff check packages/vendor-connectors/src/ packages/vendor-connectors/tests/
    ruff format --check packages/

[testenv:typecheck]
description = Type-check all Python packages
skip_install = true
deps =
    mypy>=1.8.0
    types-PyYAML>=6.0.12.20240724
    sortedcontainers-stubs>=2.4.2
    {toxinidir}/packages/extended-data-types
    {toxinidir}/packages/lifecyclelogging
    {toxinidir}/packages/directed-inputs-class
    {toxinidir}/packages/vendor-connectors
commands =
    mypy packages/extended-data-types/src/
    mypy packages/lifecyclelogging/src/
    mypy packages/directed-inputs-class/src/

# ── Docs environment ─────────────────────────────────

[testenv:docs]
description = Build Sphinx API docs as markdown
changedir = docs
deps =
    sphinx>=7.0
    myst-parser>=3.0.1
    sphinx-autodoc-typehints>=2.0.0
    sphinx-autodoc2>=0.5.0
    sphinx-markdown-builder>=0.6.0
commands =
    sphinx-build -E -b markdown sphinx/ src/content/docs/api/ {posargs}
